jQuery(document).ready(function() {
	var in_process = false;	
	jQuery('.tao_submit').on('click', function() {
		var popup = jQuery(this).data('popup');
		var form_id = jQuery(this).data('id');
		var is_ok = true;
		var email = jQuery('#tao_email_' + form_id).val();
		var name = jQuery('#tao_name_' + form_id).val();
		var agree = jQuery('#agree_' + form_id);
		//Validation
		if (name.trim() == '' && email.trim() == '') {
			is_ok = false;
			jQuery('#tao_sub_err_message_' + form_id).html('Please enter your contact details.');
			jQuery('.tao_sub_err_row_' + form_id).show();
		} else if (name.trim() == '') {
			is_ok = false;
			jQuery('#tao_sub_err_message').html('Please enter in your first name.');
			jQuery('.tao_sub_err_row_' + form_id).show();
		} else if (email.trim() == '') {
			is_ok = false;
			jQuery('#tao_sub_err_message_' + form_id).html('Please enter in your email.');
			jQuery('.tao_sub_err_row_' + form_id).show();			
		} else if (!/^\w+([\.-]?\w+)*@\w+([\.-]?\w+)*(\.\w{2,3})+$/.test(email)) {
			is_ok = false;
			jQuery('#tao_sub_err_message_' + form_id).html('Please enter a valid email.');
			jQuery('.tao_sub_err_row_' + form_id).show();			
		}	
		//Submit
		if ((is_ok == true) && (in_process == false)) {
			//Hide the error message
			jQuery('.tao_sub_err_row_' + form_id).hide();			
            in_process = true;
			jQuery.ajax(tao.s, {
				timeout: 60000,
				data: {
					'action': 'tao_subscribe',
					'nc': tao.sbn,
					'email': jQuery('#tao_email_' + form_id).val(),
					'name': jQuery('#tao_name_' + form_id).val()
				},
				type: "POST",
				error: function() {				
					in_process = false;
					jQuery('#tao_submit').css('opacity','1');
					jQuery('#tao_submit').css('cursor','pointer');					
					//Report error message
					jQuery('#tao_sub_err_message_' + form_id).html('Something went wrong, try again or at support@thriveasone.ca');
					jQuery('.tao_sub_err_row_' + form_id).show();						
				},
				beforeSend: function() {
					jQuery('#tao_submit_' + form_id).css('opacity','0.5');
					jQuery('#tao_submit_' + form_id).css('cursor','wait');
				},
				success: function(response) {
					//Replace the form with a thank you block
					jQuery('.tao_sub_thx_row_' + form_id).show();
					jQuery('.tao_sub_frm_' + form_id).hide();
					jQuery('.tao_agree_' + form_id).hide();
					jQuery('#tao_submit_' + form_id).hide();
					//Block popup
					if (popup != '') {
						if (typeof window.tao_stop_pop == "function") {
							tao_stop_pop(popup);
						}					
					}
				},
				complete: function() {
					//Leave box greyed out
				}
			});				
		}
	});
});